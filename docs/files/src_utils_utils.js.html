<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\utils\utils.js - GrapeFruit Game Engine</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://www.gravatar.com/avatar/e60ee7bcb380d1ab175251890046b3d8.png" title="GrapeFruit Game Engine"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: v0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ATLAS_FORMAT.html">ATLAS_FORMAT</a></li>
            
                <li><a href="../classes/AudioManager.html">AudioManager</a></li>
            
                <li><a href="../classes/AudioPlayer.html">AudioPlayer</a></li>
            
                <li><a href="../classes/AXIS.html">AXIS</a></li>
            
                <li><a href="../classes/BaseTexture.html">BaseTexture</a></li>
            
                <li><a href="../classes/BitmapText.html">BitmapText</a></li>
            
                <li><a href="../classes/Cache.html">Cache</a></li>
            
                <li><a href="../classes/Camera.html">Camera</a></li>
            
                <li><a href="../classes/CAMERA_FOLLOW.html">CAMERA_FOLLOW</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Clock.html">Clock</a></li>
            
                <li><a href="../classes/Container.html">Container</a></li>
            
                <li><a href="../classes/DIRECTION.html">DIRECTION</a></li>
            
                <li><a href="../classes/Ellipse.html">Ellipse</a></li>
            
                <li><a href="../classes/EventEmitter.html">EventEmitter</a></li>
            
                <li><a href="../classes/FILE_FORMAT.html">FILE_FORMAT</a></li>
            
                <li><a href="../classes/fx.camera.Close.html">fx.camera.Close</a></li>
            
                <li><a href="../classes/fx.camera.Effect.html">fx.camera.Effect</a></li>
            
                <li><a href="../classes/fx.camera.Fade.html">fx.camera.Fade</a></li>
            
                <li><a href="../classes/fx.camera.Flash.html">fx.camera.Flash</a></li>
            
                <li><a href="../classes/fx.camera.Scanlines.html">fx.camera.Scanlines</a></li>
            
                <li><a href="../classes/fx.camera.Shake.html">fx.camera.Shake</a></li>
            
                <li><a href="../classes/Game.html">Game</a></li>
            
                <li><a href="../classes/Gamepad.html">Gamepad</a></li>
            
                <li><a href="../classes/GamepadButtons.html">GamepadButtons</a></li>
            
                <li><a href="../classes/GamepadSticks.html">GamepadSticks</a></li>
            
                <li><a href="../classes/Graphics.html">Graphics</a></li>
            
                <li><a href="../classes/GuiItem.html">GuiItem</a></li>
            
                <li><a href="../classes/Input.html">Input</a></li>
            
                <li><a href="../classes/InputManager.html">InputManager</a></li>
            
                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/math.html">math</a></li>
            
                <li><a href="../classes/ObjectFactory.html">ObjectFactory</a></li>
            
                <li><a href="../classes/ObjectGroup.html">ObjectGroup</a></li>
            
                <li><a href="../classes/ObjectPool.html">ObjectPool</a></li>
            
                <li><a href="../classes/ParticleEmitter.html">ParticleEmitter</a></li>
            
                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
            
                <li><a href="../classes/PhysicsSystem.html">PhysicsSystem</a></li>
            
                <li><a href="../classes/PhysicsTarget.html">PhysicsTarget</a></li>
            
                <li><a href="../classes/pkg.html">pkg</a></li>
            
                <li><a href="../classes/plugin.html">plugin</a></li>
            
                <li><a href="../classes/Pointer.html">Pointer</a></li>
            
                <li><a href="../classes/Pointers.html">Pointers</a></li>
            
                <li><a href="../classes/Polygon.html">Polygon</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/RENDERER.html">RENDERER</a></li>
            
                <li><a href="../classes/RenderTexture.html">RenderTexture</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/SpritePool.html">SpritePool</a></li>
            
                <li><a href="../classes/State.html">State</a></li>
            
                <li><a href="../classes/StateManager.html">StateManager</a></li>
            
                <li><a href="../classes/support.html">support</a></li>
            
                <li><a href="../classes/Text.html">Text</a></li>
            
                <li><a href="../classes/Texture.html">Texture</a></li>
            
                <li><a href="../classes/Tile.html">Tile</a></li>
            
                <li><a href="../classes/Tilelayer.html">Tilelayer</a></li>
            
                <li><a href="../classes/Tilemap.html">Tilemap</a></li>
            
                <li><a href="../classes/Tileset.html">Tileset</a></li>
            
                <li><a href="../classes/TilingSprite.html">TilingSprite</a></li>
            
                <li><a href="../classes/utils.html">utils</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
                <li><a href="../classes/World.html">World</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\utils\utils.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var Vector = require(&#x27;../math/Vector&#x27;),
    Circle = require(&#x27;../geom/Circle&#x27;),
    Rectangle = require(&#x27;../geom/Rectangle&#x27;),
    Polygon = require(&#x27;../geom/Polygon&#x27;);

/**
 * The grapefruit utility object, used for misc functions used throughout the code base
 *
 * @class utils
 * @extends Object
 * @static
 */
var utils = {
    _arrayDelim: /[|,]/,
    /**
     * An empty function that performs no action
     *
     * @method noop
     */
    noop: function() {},
    /**
     * Gets the absolute url from a relative one
     *
     * @method getAbsoluteUrl
     * @param url {String} The relative url to translate into absolute
     * @return {String} The absolute url (fully qualified)
     */
    getAbsoluteUrl: function(url) {
        var a = document.createElement(&#x27;a&#x27;);
        a.href = url;
        return a.href;
    },
    /**
     * Performs an ajax request, and manages the callbacks passed in
     *
     * @method ajax
     * @param settings {Object} The settings of the ajax request, similar to jQuery&#x27;s ajax function
     * @return {XMLHttpRequest|ActiveXObject} An XHR object
     */
    ajax: function(sets) {
        //base settings
        sets = sets || {};
        sets.method = sets.method || &#x27;GET&#x27;;
        sets.dataType = sets.dataType || &#x27;text&#x27;;

        if(!sets.url)
            throw new TypeError(&#x27;Undefined URL passed to ajax&#x27;);

        //callbacks
        sets.progress = sets.progress || utils.noop;
        sets.load = sets.load || utils.noop;
        sets.error = sets.error || utils.noop;
        sets.abort = sets.abort || utils.noop;
        sets.complete = sets.complete || utils.noop;

        var xhr = utils.createAjaxRequest(),
            protocol = utils.getAbsoluteUrl(sets.url).split(&#x27;/&#x27;)[0];

        xhr.onreadystatechange = function() {
            if(xhr.readyState === 4) {
                var res = xhr.response || xhr.responseText,
                    err = null;

                //The &#x27;file:&#x27; protocol doesn&#x27;t give response codes
                if(protocol !== &#x27;file:&#x27; &amp;&amp; xhr.status !== 200)
                    err = &#x27;Non-200 status code returned: &#x27; + xhr.status;

                if(!err &amp;&amp; typeof res === &#x27;string&#x27;) {
                    if(sets.dataType === &#x27;json&#x27;) {
                        try {
                            res = JSON.parse(res);
                        } catch(e) {
                            err = e;
                        }
                    } else if(sets.dataType === &#x27;xml&#x27;) {
                        try {
                            res = utils.parseXML(res);
                        } catch(e) {
                            err = e;
                        }
                    }
                }

                if(err) {
                    if(sets.error) sets.error.call(xhr, err);
                } else {
                    if(sets.load) sets.load.call(xhr, res);
                }
            }
        };

        //chrome doesn&#x27;t support json responseType, some browsers choke on XML type
        if(sets.dataType !== &#x27;json&#x27; &amp;&amp; sets.dataType !== &#x27;xml&#x27;)
            xhr.responseType = sets.dataType;
        else
            xhr.responseType = &#x27;text&#x27;;

        xhr.open(sets.method, sets.url, true);
        xhr.send();

        return xhr;
    },
    /**
     * Wraps XMLHttpRequest in a cross-browser way.
     *
     * @method AjaxRequest
     * @return {XMLHttpRequest|ActiveXObject}
     */
    //from pixi.js
    createAjaxRequest: function() {
        //activeX versions to check for in IE
        var activexmodes = [&#x27;Msxml2.XMLHTTP&#x27;, &#x27;Microsoft.XMLHTTP&#x27;];

        //Test for support for ActiveXObject in IE first (as XMLHttpRequest in IE7 is broken)
        if(window.ActiveXObject) {
            for(var i=0; i&lt;activexmodes.length; i++) {
                try {
                    return new window.ActiveXObject(activexmodes[i]);
                }
                catch(e) {
                    //suppress error
                }
            }
        }
        // if Mozilla, Safari etc
        else if(window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }
        else {
            return false;
        }
    },
    /**
     * This will take values and override the passed obj&#x27;s properties with those values.
     * The difference from a normal object extend is that this will try to massage the passed
     * value into the same type as the object&#x27;s property. Also if the key for the value is not
     * in the original object, it is not copied.
     *
     * @method setValues
     * @param obj {Object} The object to extend the values into
     * @param values {Object} The values to put into the object
     * @return {Object} returns the updated object
     * @example
     *      var obj = { vec: new Vector(), arr: [] },
     *          vals = { vec: &#x27;2|5&#x27;, arr: &#x27;5|10|11&#x27; };
     *      utils.setValues(obj, vals);
     *      //now obj is:
     *      // { vec: Vector(2, 5), arr: [5, 10, 11] }
     *      
     */
    //similar to https://github.com/mrdoob/three.js/blob/master/src/materials/Material.js#L42
    setValues: function(obj, values) {
        if(!values) return;

        for(var key in values) {
            var newVal = values[key];

            if(newVal === undefined) {
                //console.warn(&#x27;Object parameter &#x27;&#x27; + key + &#x27;&#x27; is undefined.&#x27;);
                continue;
            }
            if(key in obj) {
                var curVal = obj[key];

                //massage strings into numbers
                if(typeof curVal === &#x27;number&#x27; &amp;&amp; typeof newVal === &#x27;string&#x27;) {
                    var n;
                    if(newVal.indexOf(&#x27;0x&#x27;) === 0) n = parseInt(newVal, 16);
                    else n = parseInt(newVal, 10);

                    if(!isNaN(n))
                        obj[key] = n;
                    /*else
                        console.warn(&#x27;Object parameter &#x27;&#x27; + key + &#x27;&#x27; evaluated to NaN, using default. Value passed: &#x27; + newVal);*/

                }
                //massage vectors
                else if(curVal instanceof Vector &amp;&amp; newVal instanceof Array) {
                    curVal.set(parseFloat(newVal[0], 10) || 0, parseFloat(newVal[1], 10) || parseFloat(newVal[0], 10) || 0);
                } else if(curVal instanceof Vector &amp;&amp; typeof newVal === &#x27;string&#x27;) {
                    var a = newVal.split(utils._arrayDelim, 2);
                    curVal.set(parseFloat(a[0], 10) || 0, parseFloat(a[1], 10) || parseFloat(a[0], 10) || 0);
                } else if(curVal instanceof Vector &amp;&amp; typeof newVal === &#x27;number&#x27;) {
                    curVal.set(newVal, newVal);
                }
                //massage arrays
                else if(curVal instanceof Array &amp;&amp; typeof newVal === &#x27;string&#x27;) {
                    obj[key] = newVal.split(utils._arrayDelim);
                    for(var i = 0, il = obj[key].length; i &lt; il; ++i) {
                        var val = obj[key][i];
                        if(!isNaN(val)) obj[key][i] = parseFloat(val, 10);
                    }
                } else {
                    obj[key] = newVal;
                }
            }
        }

        return obj;
    },
    /**
     * From jQuery.extend, extends one object into another
     * taken straight from jQuery 2.0.3
     *
     * @method extend
     */
    extend: function() {
        var src, copyIsArray, copy, name, options, clone, target = arguments[0] || {},
            i = 1,
            length = arguments.length,
            deep = false;

        // Handle a deep copy situation
        if (typeof target === &#x27;boolean&#x27;) {
            deep = target;
            target = arguments[1] || {};
            // skip the boolean and the target
            i = 2;
        }

        // Handle case when target is a string or something (possible in deep copy)
        if (typeof target !== &#x27;object&#x27; &amp;&amp; typeof target !== &#x27;function&#x27;) {
            target = {};
        }

        // extend jQuery itself if only one argument is passed
        //if (length === i) {
        //    target = this;
        //    --i;
        //}

        for (; i &lt; length; i++) {
            // Only deal with non-null/undefined values
            options = arguments[i];
            if (options !== null &amp;&amp; options !== undefined) {
                // Extend the base object
                for (name in options) {
                    src = target[name];
                    copy = options[name];

                    // Prevent never-ending loop
                    if (target === copy) {
                        continue;
                    }

                    // Recurse if we&#x27;re merging plain objects or arrays
                    if (deep &amp;&amp; copy &amp;&amp; (utils.isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {
                        if (copyIsArray) {
                            copyIsArray = false;
                            clone = src &amp;&amp; Array.isArray(src) ? src : [];

                        } else {
                            clone = src &amp;&amp; utils.isPlainObject(src) ? src : {};
                        }

                        // Never move original objects, clone them
                        target[name] = utils.extend(deep, clone, copy);

                        // Don&#x27;t bring in undefined values
                    } else if (copy !== undefined) {
                        target[name] = copy;
                    }
                }
            }
        }

        // Return the modified object
        return target;
    },
    /**
     * From jQuery.isPlainObject, checks if an object is a plain object
     * taken straight from jQuery 2.0.3
     *
     * @method isPlainObject
     * @param obj {mixed} The object to test
     * @return {Boolean}
     */
    isPlainObject: function(obj) {
        // Not plain objects:
        // - Any object or value whose internal [[Class]] property is not &quot;[object Object]&quot;
        // - DOM nodes
        // - window
        if (typeof obj !== &#x27;object&#x27; || obj.nodeType || obj === obj.window) {
            return false;
        }

        // Support: Firefox &lt;20
        // The try/catch suppresses exceptions thrown when attempting to access
        // the &quot;constructor&quot; property of certain host objects, ie. |window.location|
        // https://bugzilla.mozilla.org/show_bug.cgi?id=814622
        try {
            if (obj.constructor &amp;&amp; !Object.hasOwnProperty.call(obj.constructor.prototype, &#x27;isPrototypeOf&#x27;)) {
                return false;
            }
        } catch(e) {
            return false;
        }

        // If the function hasn&#x27;t returned already, we&#x27;re confident that
        // |obj| is a plain object, created by {} or constructed with new Object
        return true;
    },
    /**
     * Get the DOM offset values of any given element
     *
     * @method getOffset
     * @param element {HTMLElement} The targeted element that we want to retrieve the offset
     * @return {Vector} The offset of the element
     */
    getOffset: function(element) {
        var box = element.getBoundingClientRect(),
            clientTop = element.clientTop || document.body.clientTop || 0,
            clientLeft = element.clientLeft || document.body.clientLeft || 0,
            scrollTop = window.pageYOffset || element.scrollTop || document.body.scrollTop,
            scrollLeft = window.pageXOffset || element.scrollLeft || document.body.scrollLeft;

        return new Vector(
            box.left + scrollLeft - clientLeft,
            box.top + scrollTop - clientTop
        );
    },
    /**
     * Parses an array of numbers that represent a hitArea into the actual shape.
     *
     * For example: &#x60;[1, 1, 15]&#x60; is a Circle (&#x60;[x, y, radius]&#x60;); &#x60;[1, 1, 15, 15]&#x60; is a Rectangle
     * (&#x60;[x, y, width, height]&#x60;); and any length &gt;= 5 is a polygon in the form &#x60;[x1, y1, x2, y2, ..., xN, yN]&#x60;.
     *
     * @method parseHitArea
     * @param value {Array&lt;Number&gt;} The array to parse
     * @return {Circle|Rectangle|Polygon} The parsed out shape
     */
    parseHitArea: function(hv) {
        var ha;

        //odd number of values
        if(hv.length % 2 !== 0 &amp;&amp; hv.length !== 3) {
            throw new RangeError(&#x27;Strange number of values for hitArea! Should be a flat array of values, like: [x,y,r] for a circle, [x,y,w,h] for a rectangle, or [x,y,x,y,...] for other polygons.&#x27;);
        }

        //a circle x,y,r
        if(hv.length === 3) {
            ha = new Circle(hv[0], hv[1], hv[2]);
        }
        //a rectangle x,y,w,h
        else if(hv.length === 4) {
            ha = new Rectangle(hv[0], hv[1], hv[2], hv[3]);
        }
        //generic polygon
        else {
            ha = new Polygon(0, 0, hv);
        }

        return ha;
    },
    /**
     * Parses an object of string properties into potential javascript types. First it attempts to
     * convert to a number, if that fails it checks for the string &#x27;true&#x27; or &#x27;false&#x27; and changes it
     * to the actual Boolean value, then it attempts to parse a string as JSON.
     *
     * @method parseTiledProperties
     * @param value {Array&lt;Number&gt;} The array to parse
     * @return {Circle|Rectangle|Polygon} The parsed out shape
     */
    parseTiledProperties: function(obj) {
        if(!obj || obj.__tiledparsed)
            return obj;

        for(var k in obj) {
            var v = obj[k],
                n = parseFloat(v, 10);

            //try to massage numbers
            if(n === 0 || n)
                obj[k] = n;
            //true values
            else if(v === &#x27;true&#x27;)
                obj[k] = true;
            //false values
            else if(v === &#x27;false&#x27;)
                obj[k] = false;
            //anything else is either a string or json, try json
            else {
                try{
                    v = JSON.parse(v);
                    obj[k] = v;
                } catch(e) {}
            }
        }

        //after parsing, check some other things
        if(obj.hitArea)
            obj.hitArea = utils.parseHitArea(obj.hitArea);

        if(obj.body === &#x27;static&#x27; || obj.sensor) {
            obj.mass = Infinity;
            obj.inertia = Infinity;
        }

        obj.__tiledparsed = true;

        return obj;
    },
    _logger: window.console || {},
    /**
     * Safe way to log to console, if console.log doesn&#x27;t exist nothing happens.
     *
     * @method log
     */
    log: function() {
        if(utils._logger.log)
            utils._logger.log.apply(utils._logger, arguments);
    },
    /**
     * Safe way to warn to console, if console.warn doesn&#x27;t exist nothing happens.
     *
     * @method warn
     */
    warn: function() {
        if(utils._logger.warn)
            utils._logger.warn.apply(utils._logger, arguments);
    },
    /**
     * Safe way to error to console, if console.error doesn&#x27;t exist nothing happens.
     *
     * @method error
     */
    error: function() {
        if(utils._logger.error)
            utils._logger.error.apply(utils._logger, arguments);
    }
};

/**
 * Parses an XML string into a Document object. Will use window.DOMParser
 * if available, falling back to Microsoft.XMLDOM ActiveXObject in IE.
 *
 * Eventually, it would be nice to include a node.js alternative as well
 * for running in that environment.
 *
 * @method parseXML
 * @param xmlStr {String} The xml string to parse
 * @return {Document} An XML Document
 */
//XML Parser in window
if(typeof window.DOMParser !== &#x27;undefined&#x27;) {
    utils.parseXML = function(xmlStr) {
        return (new window.DOMParser()).parseFromString(xmlStr, &#x27;text/xml&#x27;);
    };
}
//IE specific XML parser
else if(typeof window.ActiveXObject !== &#x27;undefined&#x27; &amp;&amp; new window.ActiveXObject(&#x27;Microsoft.XMLDOM&#x27;)) {
    utils.parseXML = function(xmlStr) {
        var xmlDoc = new window.ActiveXObject(&#x27;Microsoft.XMLDOM&#x27;);
        xmlDoc.async = &#x27;false&#x27;;
        xmlDoc.loadXML(xmlStr);
        return xmlDoc;
    };
}
//node.js environment
/*else if(__isNode) {
    utils.parseXML = function(xmlStr) {
        var DOMParser = require(&#x27;xmldom&#x27;).DOMParser;
        return (new DOMParser()).parseFromString(xmlStr, &quot;text/xml&quot;);
    };
}*/
// no parser available
else {
    utils.warn(&#x27;XML parser not available, trying to parse any XML will result in an error.&#x27;);
    utils.parseXML = function() {
        throw new Error(&#x27;Trying to parse XML, but not XML parser is available in this environment&#x27;);
    };
}

module.exports = utils;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
