<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\game\Game.js - GrapeFruit Game Engine</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://www.gravatar.com/avatar/e60ee7bcb380d1ab175251890046b3d8.png" title="GrapeFruit Game Engine"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: v0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/ATLAS_FORMAT.html">ATLAS_FORMAT</a></li>
            
                <li><a href="../classes/AudioManager.html">AudioManager</a></li>
            
                <li><a href="../classes/AudioPlayer.html">AudioPlayer</a></li>
            
                <li><a href="../classes/AXIS.html">AXIS</a></li>
            
                <li><a href="../classes/BaseTexture.html">BaseTexture</a></li>
            
                <li><a href="../classes/BitmapText.html">BitmapText</a></li>
            
                <li><a href="../classes/Cache.html">Cache</a></li>
            
                <li><a href="../classes/Camera.html">Camera</a></li>
            
                <li><a href="../classes/CAMERA_FOLLOW.html">CAMERA_FOLLOW</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Clock.html">Clock</a></li>
            
                <li><a href="../classes/Container.html">Container</a></li>
            
                <li><a href="../classes/DIRECTION.html">DIRECTION</a></li>
            
                <li><a href="../classes/Ellipse.html">Ellipse</a></li>
            
                <li><a href="../classes/EventEmitter.html">EventEmitter</a></li>
            
                <li><a href="../classes/FILE_FORMAT.html">FILE_FORMAT</a></li>
            
                <li><a href="../classes/fx.camera.Close.html">fx.camera.Close</a></li>
            
                <li><a href="../classes/fx.camera.Effect.html">fx.camera.Effect</a></li>
            
                <li><a href="../classes/fx.camera.Fade.html">fx.camera.Fade</a></li>
            
                <li><a href="../classes/fx.camera.Flash.html">fx.camera.Flash</a></li>
            
                <li><a href="../classes/fx.camera.Scanlines.html">fx.camera.Scanlines</a></li>
            
                <li><a href="../classes/fx.camera.Shake.html">fx.camera.Shake</a></li>
            
                <li><a href="../classes/Game.html">Game</a></li>
            
                <li><a href="../classes/Gamepad.html">Gamepad</a></li>
            
                <li><a href="../classes/GamepadButtons.html">GamepadButtons</a></li>
            
                <li><a href="../classes/GamepadSticks.html">GamepadSticks</a></li>
            
                <li><a href="../classes/Graphics.html">Graphics</a></li>
            
                <li><a href="../classes/GuiItem.html">GuiItem</a></li>
            
                <li><a href="../classes/Input.html">Input</a></li>
            
                <li><a href="../classes/InputManager.html">InputManager</a></li>
            
                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/math.html">math</a></li>
            
                <li><a href="../classes/ObjectFactory.html">ObjectFactory</a></li>
            
                <li><a href="../classes/ObjectGroup.html">ObjectGroup</a></li>
            
                <li><a href="../classes/ObjectPool.html">ObjectPool</a></li>
            
                <li><a href="../classes/ParticleEmitter.html">ParticleEmitter</a></li>
            
                <li><a href="../classes/ParticleSystem.html">ParticleSystem</a></li>
            
                <li><a href="../classes/PhysicsSystem.html">PhysicsSystem</a></li>
            
                <li><a href="../classes/PhysicsTarget.html">PhysicsTarget</a></li>
            
                <li><a href="../classes/pkg.html">pkg</a></li>
            
                <li><a href="../classes/plugin.html">plugin</a></li>
            
                <li><a href="../classes/Pointer.html">Pointer</a></li>
            
                <li><a href="../classes/Pointers.html">Pointers</a></li>
            
                <li><a href="../classes/Polygon.html">Polygon</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/RENDERER.html">RENDERER</a></li>
            
                <li><a href="../classes/RenderTexture.html">RenderTexture</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/SpritePool.html">SpritePool</a></li>
            
                <li><a href="../classes/State.html">State</a></li>
            
                <li><a href="../classes/StateManager.html">StateManager</a></li>
            
                <li><a href="../classes/support.html">support</a></li>
            
                <li><a href="../classes/Text.html">Text</a></li>
            
                <li><a href="../classes/Texture.html">Texture</a></li>
            
                <li><a href="../classes/Tile.html">Tile</a></li>
            
                <li><a href="../classes/Tilelayer.html">Tilelayer</a></li>
            
                <li><a href="../classes/Tilemap.html">Tilemap</a></li>
            
                <li><a href="../classes/Tileset.html">Tileset</a></li>
            
                <li><a href="../classes/TilingSprite.html">TilingSprite</a></li>
            
                <li><a href="../classes/utils.html">utils</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
                <li><a href="../classes/World.html">World</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\game\Game.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var StateManager = require(&#x27;./StateManager&#x27;),
    EventEmitter = require(&#x27;../utils/EventEmitter&#x27;),
    Cache = require(&#x27;../utils/Cache&#x27;),
    Clock = require(&#x27;../utils/Clock&#x27;),
    SpritePool = require(&#x27;../utils/SpritePool&#x27;),
    Loader = require(&#x27;../loader/Loader&#x27;),
    InputManager = require(&#x27;../input/InputManager&#x27;),
    AudioManager = require(&#x27;../audio/AudioManager&#x27;),
    Vector = require(&#x27;../math/Vector&#x27;),
    utils = require(&#x27;../utils/utils&#x27;),
    support = require(&#x27;../utils/support&#x27;),
    inherit = require(&#x27;../utils/inherit&#x27;),
    PIXI = require(&#x27;../vendor/pixi&#x27;),
    C = require(&#x27;../constants&#x27;);

/**
 * Main game object, controls the entire instance of the game
 *
 * @class Game
 * @extends Object
 * @uses EventEmitter
 * @constructor
 * @param container {DOMElement|String} The container for the new canvas we will create for the game, or the ID of one
 * @param settings {Object} All the settings for the game instance
 * @param settings.width {Number} The width of the viewport
 * @param settings.height {Number} The height of the viewport
 * @param [settings.renderer=RENDERER.AUTO] {String} The renderer to use either RENDERER.AUTO, RENDERER.CANVAS, or RENDERER.WEBGL
 * @param [settings.transparent=false] {Boolean} Should the render element have a transparent background
 * @param [settings.background=&#x27;#FFF&#x27;] {Number} The background color of the stage
 * @param [settings.antialias=true] {Boolean} Anti-alias graphics (in WebGL this helps with edges, in Canvas2D it retains pixel-art quality)
 * @param [settings.canvas] {DOMElement} The canvas to render into, if not specified one is created
 */
var Game = function(container, settings) {
    EventEmitter.call(this);

    //setup settings defaults
    settings = settings || {};
    settings.width = settings.width || 800;
    settings.height = settings.height || 600;
    settings.renderer = settings.renderer || C.RENDERER.AUTO;
    settings.transparent = settings.transparent || false;
    settings.background = settings.background || &#x27;#FFF&#x27;;
    settings.antialias = settings.antialias !== undefined ? settings.antialias : true;
    settings.canvas = settings.canvas || null; //passing null to renderer, lets the renderer make one

    /**
     * The domElement that we are putting our rendering canvas into (the container)
     *
     * @property container
     * @type DOMELement
     * @readOnly
     */
    this.container = typeof container === &#x27;string&#x27; ? document.getElementById(container) : container;

    if(!this.container)
        this.container = document.body;

    /**
     * The width of the render viewport
     *
     * @property width
     * @type Number
     * @default 800
     */
    this.width = settings.width;

    /**
     * The height of the render viewport
     *
     * @property height
     * @type Number
     * @default 600
     */
    this.height = settings.height;

    /**
     * The method used to render values to the screen (either webgl, or canvas)
     *
     * @property renderMethod
     * @type String
     * @default RENDERER.AUTO
     */
    this.renderMethod = settings.renderer;

    /**
     * Whether the canvas has a transparent background or not
     *
     * @property transparent
     * @type Boolean
     * @default false
     */
    this.transparent = settings.transparent;

    /**
     * The background of the stage
     *
     * @property background
     * @type Boolean
     * @default false
     */
    this.background = settings.background;

    /**
     * Anti-alias graphics (in WebGL this helps with edges, in Canvas2D it retains pixel-art quality)
     *
     * @property antialias
     * @type Boolean
     * @default true
     */
    this.antialias = settings.antialias;

    /**
     * The canvas to render into
     *
     * @property canvas
     * @type HTMLCanvasElement
     */
    this.canvas = settings.canvas;

    /**
     * Raw rendering engine, the underlying PIXI renderer that draws for us
     *
     * @property renderer
     * @type PIXI.WebGLRenderer|PIXI.CanvasRenderer
     * @readOnly
     */
    this.renderer = this._createRenderer();

    /**
     * Raw PIXI.stage instance, the root of all things in the scene graph
     *
     * @property stage
     * @type PIXI.Stage
     * @readOnly
     */
    this.stage = new PIXI.Stage(this.background);

    /**
     * Clock instance for internal timing
     *
     * @property clock
     * @type Clock
     * @readOnly
     */
    this.clock = new Clock();

    /**
     * The audio manager for this game instance, used to play and control
     * all the audio in a game.
     *
     * @property audio
     * @type AudioManager
     * @readOnly
     */
    this.audio = new AudioManager(this);

    /**
     * The loader for this game instance, used to preload assets into the cache
     *
     * @property loader
     * @type Loader
     * @readOnly
     */
    this.load = new Loader(this);

    /**
     * Cache instance for storing/retrieving assets
     *
     * @property cache
     * @type Cache
     * @readOnly
     */
    this.cache = new Cache(this);

    /**
     * The input instance for this game
     *
     * @property input
     * @type InputManager
     * @readOnly
     */
    this.input = new InputManager(this);

    /**
     * The sprite pool to use to create registered entities
     *
     * @property spritepool
     * @type SpritePool
     * @readOnly
     */
    this.spritepool = new SpritePool(this);

    /**
     * The state manager, to switch between game states
     *
     * @property state
     * @type StateManager
     * @readOnly
     */
    this.state = new StateManager(this);

    /**
     * The offset for the viewport in the document
     *
     * @property offset
     * @type Vector
     * @readOnly
     */
    this.offset = new Vector();

    /**
     * Holds timing data for the previous loop
     *
     * @property timings
     * @type Object
     * @readOnly
     */
    this.timings = {};

    //pixi does some prevent default on mousedown, so we need to
    //make sure mousedown will focus the canvas or keyboard events break
    var view = this.canvas;
    if(!view.getAttribute(&#x27;tabindex&#x27;))
        view.setAttribute(&#x27;tabindex&#x27;,&#x27;1&#x27;);

    view.focus();
    view.addEventListener(&#x27;click&#x27;, function() {
        view.focus();
    }, false);

    /**
     * Fired each frame after everything has updated, but just before rendering
     *
     * @event tick
     * @param dt {Number} The number of seconds passed since the last tick call (delta time)
     */
};

inherit(Game, Object, {
    /**
     * Creates the underlying renderer based on browser support. It will also set&#x27;s &#x60;game.renderMethod&#x60; for a user
     * to be able to check.
     *
     * @method _createRenderer
     * @return {PIXI.WebGLRenderer|PIXI.CanvasRenderer} The renderer to use
     * @private
     */
    _createRenderer: function() {
        var method = this.renderMethod,
            render = null;

        //no support
        if(!support.webgl &amp;&amp; !support.canvas) {
            throw new Error(&#x27;Neither WebGL nor Canvas is supported by this browser!&#x27;);
        }
        else if((method === C.RENDERER.WEBGL || method === C.RENDERER.AUTO) &amp;&amp; support.webgl) {
            method = C.RENDERER.WEBGL;
            render = new PIXI.WebGLRenderer(this.width, this.height, this.canvas, this.transparent, this.antialias);
        }
        else if((method === C.RENDERER.CANVAS || method === C.RENDERER.AUTO) &amp;&amp; support.canvas) {
            method = C.RENDERER.CANVAS;
            render = new PIXI.CanvasRenderer(this.width, this.height, this.canvas, this.transparent);
        }
        else {
            throw new Error(&#x27;Your render method (&quot;&#x27; + method + &#x27;&quot;) is not supported by this browser!&#x27;);
        }

        //append the renderer view only if the user didn&#x27;t pass their own
        if(!this.canvas) {
            this.container.appendChild(render.view);
            this.canvas = render.view;
        }

        this.offset = utils.getOffset(this.canvas);
        this.renderMethod = method;

        return render;
    },
    /**
     * Allows you to resize the game area.
     *
     * @method resize
     * @param width {Number} Width to resize to
     * @param height {Number} Height to resize to
     * @return {Game} Returns itself.
     * @chainable
     */
    resize: function(w, h) {
        this.renderer.resize(w, h);
        this.width = w;
        this.height = h;

        for(var i = 0, il = this.stage.children.length; i &lt; il; ++i) {
            var o = this.stage.children[i];

            if(o.resize)
                o.resize(w, h);
        }

        return this;
    },
    /**
     * Requests that the browser go into fullscreen mode.
     *
     * @method requestFullscreen
     * @return {Game} Returns itself.
     * @chainable
     */
    requestFullscreen: function() {
        var elem = this.renderer.view;

        if(elem.requestFullscreen) {
            elem.requestFullscreen();
        } else if(elem.mozRequestFullScreen) {
            elem.mozRequestFullScreen();
        } else if(elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        }

        return this;
    },
    /**
     * Begins the render loop.
     *
     * @method render
     * @return {Game} Returns itself.
     * @chainable
     */
    render: function() {
        this.clock.start();
        this._tick();

        return this;
    },
    /**
     * The looping render tick.
     *
     * @method _tick
     * @private
     */
    _tick: function() {
        this.timings.tickStart = this.clock.now();

        //start render loop
        window.requestAnimFrame(this._tick.bind(this));

        var dt = this.clock.getDelta();

        this.timings.lastDelta = dt;

        //gather input from user
        this.timings.inputStart = this.clock.now();
        this.input.update(dt);
        this.timings.inputEnd = this.clock.now();

        //TODO: plugins
        //this.timings.pluginsStart = this.clock.now();
        //this.plugins.update(dt);
        //this.timings.pluginsEnd = this.clock.now();

        //update this game state
        this.timings.stateStart = this.clock.now();
        this.state.active.update(dt);
        this.timings.stateEnd = this.clock.now();

        this.timings.userFuncsStart = this.clock.now();
        this.emit(&#x27;tick&#x27;, dt);
        this.timings.userFuncsEnd = this.clock.now();

        //render scene
        this.timings.renderStart = this.clock.now();
        this.renderer.render(this.stage);
        this.timings.renderEnd = this.clock.now();

        this.timings.tickEnd = this.clock.now();
    }
});

/**
 * Alias for the active State&#x27;s physics object. Instead of using
 * &#x60;game.state.active.physics&#x60;, you can use &#x60;game.physics&#x60;
 *
 * @property physics
 * @type Physics
 * @readOnly
 */
Object.defineProperty(Game.prototype, &#x27;physics&#x27;, {
    get: function() {
        return this.state.active.physics;
    }
});

/**
 * Alias for the active State&#x27;s camera object. Instead of using
 * &#x60;game.state.active.camera&#x60;, you can use &#x60;game.camera&#x60;
 *
 * @property camera
 * @type Camera
 * @readOnly
 */
Object.defineProperty(Game.prototype, &#x27;camera&#x27;, {
    get: function() {
        return this.state.active.camera;
    }
});

/**
 * Alias for the active State&#x27;s world object. Instead of using
 * &#x60;game.state.active.world&#x60;, you can use &#x60;game.world&#x60;
 *
 * @property world
 * @type World
 * @readOnly
 */
Object.defineProperty(Game.prototype, &#x27;world&#x27;, {
    get: function() {
        return this.state.active.world;
    }
});

module.exports = Game;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
